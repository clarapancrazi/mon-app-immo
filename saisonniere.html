<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Location saisonni√®re ‚Äì √©dition libre</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background-color: #0c2d48;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .sidebar h2 {
      margin-bottom: 30px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      margin: 10px 0;
      font-weight: bold;
    }
    .main-content {
      flex: 1;
      background-color: #f9f9f9;
      padding: 40px;
      overflow-y: auto;
    }
    .page-title {
      font-size: 28px;
      font-weight: 600;
      color: #0c2d48;
      margin-bottom: 30px;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .card:hover {
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }
    .card h4 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #0c2d48;
    }
    .card p {
      margin: 0;
      font-size: 14px;
      color: #333;
    }
    .section {
      margin-bottom: 30px;
    }
    .section h3 {
      color: #0c2d48;
      margin-bottom: 16px;
      font-size: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    th,
    td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #0c2d48;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f1f5f9;
    }
    .btn {
      background-color: #0c2d48;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 30px;
    }
    .btn-add {
      margin: 15px 0;
    }
    .btn-save {
      margin-left: 15px;
    }
    .btn-delete {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      line-height: 1;
      display: block;
      margin: auto;
    }
    .status-ok {
      color: green;
      font-weight: bold;
    }
    .status-ko {
      color: red;
      font-weight: bold;
    }
    /* Couleurs des formules et statuts dans les menus d√©roulants */
    select.formule-gardiennage option[value="LIBERTE"],
    select.formule-gestion option[value="BASE"],
    select.status-select option[value="√Ä renouveler"],
    select.yesno-select option[value="Non"] {
      color: red;
    }
    select.formule-gardiennage option[value="TRANQUILITE"],
    select.formule-gestion option[value="OPTIMUM"] {
      color: purple;
    }
    select.formule-gardiennage option[value="EXTRA"],
    select.formule-gestion option[value="ONE SHOT"],
    select.status-select option[value="√Ä jour"],
    select.yesno-select option[value="Oui"] {
      color: green;
    }
    /* Filtres gardiennage */
    .filters {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 10px 0 20px;
    }
    .filters label {
      font-weight: bold;
      color: #0c2d48;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Pancrazi Immobilier</h2>
    <a href="dashboard.html">Tableau de bord</a>
    <a href="equipe.html">√âquipe & Commerciaux</a>
    <a href="transactions.html">Transactions</a>
    <a href="locations.html">Locations</a>
    <a href="gestion.html">Gestion locative</a>
    <a href="saisonniere.html">Location saisonni√®re</a>
    <a href="clients.html">Acc√®s clients</a>
    <a href="simulateurs.html">Outils & simulateurs</a>
    <a href="administratif.html">Administratif agence</a>
  </div>

  <div class="main-content">
    <div class="page-title">Location Saisonni√®re
      <button class="btn btn-save" id="btn-save">üíæ Enregistrer</button>
    </div>

    <button class="btn" onclick="location.href='nouvelle-location-saisonniere.html'">
      Cr√©er une location saisonni√®re
    </button>
    <button
      class="btn"
      onclick="window.open('https://www.bookingsync.com/users/login?type=smily', '_blank')"
    >
      üìÜ Acc√©der √† SMILY (location saisonni√®re)
    </button>
    <button class="btn" onclick="location.href='loc-dossierclient.html'">
      üìÇ Dossier Clients
    </button>

    <div class="cards">
      <div class="card" onclick="location.href='lots-gardiennage.html'">
        <h4>Lots en gardiennage</h4>
        <p>9</p>
      </div>
      <div class="card" onclick="location.href='lots-location-saisonniere.html'">
        <h4>Lots en location saisonni√®re</h4>
        <p>18</p>
      </div>
      <div class="card">
        <h4>Volume de r√©servations</h4>
        <p>84 294 ‚Ç¨</p>
      </div>
      <div class="card">
        <h4>Honoraires mensuels gardiennage</h4>
        <p>119 ‚Ç¨</p>
      </div>
      <div class="card">
        <h4>Honoraires mensuels location saisonni√®re</h4>
        <p>550 ‚Ç¨</p>
      </div>
    </div>

    <!-- 1) CONTRATS -->
    <div class="section">
      <h3>Suivi des contrats</h3>
      <table data-manage id="table-contrats">
        <thead>
          <tr>
            <th>Client</th>
            <th>Bien</th>
            <th>Formule gardiennage</th>
            <th>Formule gestion locative</th>
            <th>Date de fin</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">Famille Bianca</td>
            <td contenteditable="true">Villa Bianca</td>
            <td data-select="gardiennage"></td>
            <td data-select="gestion"></td>
            <td contenteditable="true">31/10/2025</td>
            <td data-select="statut"></td>
          </tr>
          <tr>
            <td contenteditable="true">Famille Salini</td>
            <td contenteditable="true">Maison Salini</td>
            <td data-select="gardiennage"></td>
            <td data-select="gestion"></td>
            <td contenteditable="true">15/05/2024</td>
            <td data-select="statut"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 2) Gardiennage -->
    <div class="section">
      <h3>Suivi de la facturation mensuelle - Gardiennage</h3>
      <div class="filters">
        <label for="filter-month">Mois :</label>
        <select id="filter-month"></select>
        <label for="filter-year">Ann√©e :</label>
        <select id="filter-year"></select>
      </div>
      <table data-manage id="table-gardiennage">
        <thead>
          <tr>
            <th>Bien</th>
            <th>Propri√©taire</th>
            <th>Mois</th>
            <th>Ann√©e</th>
            <th>Montant</th>
            <th>Facture √©mise</th>
            <th>Facture pay√©e</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">Villa Carataggia</td>
            <td contenteditable="true">Famille Renucci</td>
            <td data-select="mois"></td>
            <td data-select="annee"></td>
            <td contenteditable="true">150 ‚Ç¨</td>
            <td data-select="yesno"></td>
            <td data-select="yesno"></td>
          </tr>
          <tr>
            <td contenteditable="true">Appartement R√©sidence Albore</td>
            <td contenteditable="true">Jean-Claude Romani</td>
            <td data-select="mois"></td>
            <td data-select="annee"></td>
            <td contenteditable="true">120 ‚Ç¨</td>
            <td data-select="yesno"></td>
            <td data-select="yesno"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 3) Sous-traitants conciergerie -->
    <div class="section">
      <h3>Suivi de la facturation - Sous-traitants conciergerie</h3>
      <table data-manage id="table-conciergerie">
        <thead>
          <tr>
            <th>Conciergerie</th>
            <th>Mois</th>
            <th>Facture re√ßue</th>
            <th>Facture pay√©e</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">√Ä Tout Service</td>
            <td contenteditable="true">Avril 2025</td>
            <td data-select="yesno"></td>
            <td data-select="yesno"></td>
          </tr>
          <tr>
            <td contenteditable="true">Uperia</td>
            <td contenteditable="true">Avril 2025</td>
            <td data-select="yesno"></td>
            <td data-select="yesno"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- *************** -->
  <!--   SCRIPT JS    -->
  <!-- *************** -->
  <script>
    (function () {
      const MANAGE_SELECTOR = "table[data-manage]";

      /* ======== CONSTANTES ======== */
      const FORMULES_GARDIENNAGE = ["LIBERTE", "TRANQUILITE", "EXTRA"];
      const FORMULES_GESTION = ["BASE", "OPTIMUM", "ONE SHOT"];
      const STATUS_OPTIONS = ["√Ä jour", "√Ä renouveler"];
      const MONTHS_FR = [
        "Janvier",
        "F√©vrier",
        "Mars",
        "Avril",
        "Mai",
        "Juin",
        "Juillet",
        "Ao√ªt",
        "Septembre",
        "Octobre",
        "Novembre",
        "D√©cembre",
      ];
      const CURRENT_YEAR = new Date().getFullYear();
      const YEARS_RANGE = Array.from({ length: 6 }, (_, i) => CURRENT_YEAR - 2 + i); // ex: 2023-2028

      const COLOR_MAP = {
        LIBERTE: "red",
        TRANQUILITE: "purple",
        EXTRA: "green",
        BASE: "red",
        OPTIMUM: "purple",
        "ONE SHOT": "green",
        "√Ä renouveler": "red",
        "√Ä jour": "green",
        Non: "red",
        Oui: "green",
      };

      /* ======== INIT ======== */
      // Restaure contenu des tableaux depuis localStorage
      document.querySelectorAll(MANAGE_SELECTOR).forEach((table) => {
        const saved = localStorage.getItem(table.id);
        if (saved) {
          table.tBodies[0].innerHTML = saved;
        }
      });

      // Construction des filtres mois/ann√©e
      buildDateFilters();

      // Apr√®s restauration, pr√©pare les tableaux (boutons, selects, etc.)
      document.querySelectorAll(MANAGE_SELECTOR).forEach((table) => initManageTable(table));

      // Bouton Enregistrer
      document.getElementById("btn-save").addEventListener("click", saveTables);

      /* ======== FONCTIONS ======== */
      function buildDateFilters() {
        const monthSel = document.getElementById("filter-month");
        MONTHS_FR.forEach((m) => {
          const opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          monthSel.appendChild(opt);
        });
        const yearSel = document.getElementById("filter-year");
        YEARS_RANGE.forEach((y) => {
          const opt = document.createElement("option");
          opt.value = y;
          opt.textContent = y;
          yearSel.appendChild(opt);
        });
        monthSel.value = MONTHS_FR[new Date().getMonth()];
        yearSel.value = CURRENT_YEAR;

        monthSel.addEventListener("change", filterGardiennageRows);
        yearSel.addEventListener("change", filterGardiennageRows);
      }

      function filterGardiennageRows() {
        const moisFiltre = document.getElementById("filter-month").value;
        const anneeFiltre = document.getElementById("filter-year").value;
        document
          .querySelectorAll("#table-gardiennage tbody tr")
          .forEach((row) => {
            const mois = row.querySelector('[data-select="mois"] select')?.value || "";
            const annee = row.querySelector('[data-select="annee"] select')?.value || "";
            row.style.display =
              (!moisFiltre || mois === moisFiltre) && (!anneeFiltre || annee === anneeFiltre)
                ? "table-row"
                : "none";
          });
      }

      function initManageTable(table) {
        addActionHeader(table);

        // Bouton Ajouter
        const addBtn = document.createElement("button");
        addBtn.textContent = "‚ûï Ajouter une ligne";
        addBtn.className = "btn btn-add";
        table.parentNode.insertBefore(addBtn, table);
        addBtn.addEventListener("click", () => addRow(table));

        // Pr√©paration des lignes existantes
        Array.from(table.tBodies[0].rows).forEach((row) => prepareRow(row));
      }

      function addActionHeader(table) {
        const headerRow = table.tHead.rows[0];
        if (!headerRow.querySelector("th[data-action-col]")) {
          const thAction = document.createElement("th");
          thAction.textContent = "Actions";
          thAction.dataset.actionCol = "true";
          headerRow.appendChild(thAction);
        }
      }

      function createSelect(arr, cssClass) {
        const select = document.createElement("select");
        select.className = cssClass;
        const empty = document.createElement("option");
        empty.value = "";
        empty.textContent = "‚Äî";
        select.appendChild(empty);
        arr.forEach((val) => {
          const opt = document.createElement("option");
          opt.value = val;
          opt.textContent = val;
          opt.style.color = COLOR_MAP[val];
          select.appendChild(opt);
        });
        select.addEventListener("change", () => {
          const v = select.value;
          select.style.color = COLOR_MAP[v] || "inherit";
          if (table.id === "table-gardiennage" && (cssClass === "month-select" || cssClass === "year-select")) {
            filterGardiennageRows();
          }
        });
        return select;
      }

      function prepareRow(row) {
        const table = row.closest("table");
        const headers = Array.from(table.tHead.rows[0].cells).map((th) => th.textContent.trim());

        headers.forEach((header, i) => {
          let cell = row.cells[i] || row.insertCell(i);

          if (header === "Formule gardiennage") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(FORMULES_GARDIENNAGE, "formule-gardiennage"));
          } else if (header === "Formule gestion locative") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(FORMULES_GESTION, "formule-gestion"));
          } else if (header === "Statut") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(STATUS_OPTIONS, "status-select"));
          } else if (header === "Facture √©mise" || header === "Facture pay√©e" || header === "Facture re√ßue") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(["Oui", "Non"], "yesno-select"));
          } else if (header === "Mois") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(MONTHS_FR, "month-select"));
          } else if (header === "Ann√©e") {
            cell.innerHTML = "";
            cell.appendChild(createSelect(YEARS_RANGE, "year-select"));
          } else if (!cell.dataset.actionCell) {
            cell.contentEditable = "true";
          }
        });

        // Cellule action
        let actionCell = row.querySelector("[data-action-cell='true']");
        if (!actionCell) {
          actionCell = row.insertCell(-1);
          actionCell.dataset.actionCell = "true";
          const delBtn = document.createElement("button");
          delBtn.textContent = "üóë";
          delBtn.title = "Supprimer la ligne";
          delBtn.className = "btn-delete";
          delBtn.addEventListener("click", () => row.remove());
          actionCell.appendChild(delBtn);
        }
      }

      function addRow(table) {
        const newRow = table.tBodies[0].insertRow(-1);
        const headers = Array.from(table.tHead.rows[0].cells).map((th) => th.textContent.trim());
        headers.forEach((header) => {
          if (header === "Actions") return;
          const cell = newRow.insertCell(-1);
        });
        prepareRow(newRow);
      }

      function saveTables() {
        document.querySelectorAll(MANAGE_SELECTOR).forEach((table) => {
          localStorage.setItem(table.id, table.tBodies[0].innerHTML);
        });
        alert("Modifications enregistr√©es ‚úîÔ∏è");
      }
    })();
  </script>
</body>
</html>
